{"ast":null,"code":"import _classCallCheck from\"/Users/Abhinav/Documents/GitHub/saasshop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/Abhinav/Documents/GitHub/saasshop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/Abhinav/Documents/GitHub/saasshop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/Abhinav/Documents/GitHub/saasshop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"/Users/Abhinav/Documents/GitHub/saasshop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/Abhinav/Documents/GitHub/saasshop/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from\"react\";import{Route,Redirect}from\"react-router-dom\";import NavBar from\"../components/NavBar/NavBar\";import Shop from\"../components/Shop/Shop\";import Cart from\"../components/Cart/Cart\";import AdminUI from\"../components/Admin/AdminUI\";import UserUI from\"../components/User/UserUI\";import AddMerch from\"../components/Admin/AddMerch\";import\"./ShopHome.css\";import SignIn from\"../components/SignIn/SignIn\";import Zoomer from\"../assets/images/shirts/zoomer.png\";import Logo from\"../assets/images/stickers/SAAS_logo.png\";import firebase from\"../firebase/firebase\";import{connect}from\"react-redux\";import*as actions from\"../store/actions/index.js\";var provider=new firebase.auth.GoogleAuthProvider();var ShopHome=/*#__PURE__*/function(_Component){_inherits(ShopHome,_Component);function ShopHome(props){var _this;_classCallCheck(this,ShopHome);_this=_possibleConstructorReturn(this,_getPrototypeOf(ShopHome).call(this,props));_this.pullShopItems=function(){firebase.firestore().collection(\"inventory\").get().then(function(snapshot){snapshot.forEach(function(item){var data=_this.state.data;data[item.id]=item.data();_this.setState({data:data});});});};_this.handleOnPullShopItems=function(){_this.props.onPullShopItems();};_this.pullAdminEmails=function(){firebase.firestore().collection(\"admin\").doc(\"emails\").get().then(function(snapshot){var data=snapshot.data();_this.setState({adminEmailList:data.email_list});});};_this.pullPastOrders=function(){firebase.firestore().collection(\"orders\").get().then(function(snapshot){snapshot.forEach(function(order){var orders=_this.state.orders;orders[order.id]=order.data();_this.setState({orders:orders});});});};_this.firebasePush=function(item){console.log(item.image);var ref=firebase.storage().ref();var name=item.description;var newRef=ref.child(name+\".png\");newRef.put(item.image).then(function(){newRef.getDownloadURL().then(function(url){console.log(url);var newInventory={category:item.category,description:item.description,image_url:url,on_order:0,sales_price:item.price,size_stock:{},sizes:[],stock:item.quantity};firebase.firestore().collection(\"inventory\").add(newInventory);});});};_this.onChange=function(itemId,direction){console.log(_this.state.data[itemId]);console.log(_this.props.itemData.itemID);var cart=_this.state.currentCart;var currentCart=cart[itemId]?cart[itemId]:0;var stock=_this.state.data[itemId].stock;var updatedCount=currentCart+direction<0?0:currentCart+direction;if(updatedCount>stock){updatedCount=stock;alert(\"Cannot add item to cart. Max stock of item reached.\");}cart[itemId]=updatedCount;_this.setState({cart:cart});};_this.calculateNumItems=function(currentCart,items){var total=0;Object.keys(items).forEach(function(key){total+=currentCart[key]?currentCart[key]:0;});return total;};_this.calculateTotalPrice=function(currentCart,items){var total=0;Object.keys(items).forEach(function(key){total+=items[key].sales_price*(currentCart[key]?currentCart[key]:0);});return total.toFixed(2);};_this.updateStock=function(itemId,direction){var data=_this.state.data;var currentStock=_this.state.data[itemId].stock;var updatedCount=currentStock+direction<0?0:currentStock+direction;data[itemId].stock=updatedCount;//need to actually update firebase\nconsole.log(data[itemId].stock);_this.setState({data:data});};_this.logOut=function(){console.log(\"log out\");firebase.auth().signOut();};_this.logIn=function(){console.log(\"log in\");firebase.auth().signInWithRedirect(provider);};_this.state={data:{},currentCart:{},orders:{},adminEmailList:[],auth:null};firebase.auth().onAuthStateChanged(function(user){_this.setState({auth:user});});_this.logOut=_this.logOut.bind(_assertThisInitialized(_this));_this.logIn=_this.logIn.bind(_assertThisInitialized(_this));return _this;}_createClass(ShopHome,[{key:\"componentDidMount\",value:function componentDidMount(){this.pullShopItems();this.pullPastOrders();this.pullAdminEmails();this.handleOnPullShopItems();}//FOR THIS COMPONENT\n},{key:\"render\",value:function render(){var _this2=this;//bottom two return the same data\n//console.log(this.props.itemData)\n//console.log(this.state.data)\nreturn React.createElement(React.Fragment,null,React.createElement(NavBar,{items:this.props.itemData,onChange:this.onChange,currentCart:this.state.currentCart,calculateTotalPrice:this.calculateTotalPrice,calculateNumItems:this.calculateNumItems,logIn:this.logIn,logOut:this.logOut,auth:this.state.auth}),React.createElement(\"div\",{className:\"gradient-divide\"}),React.createElement(Route,{exact:true,path:\"/\",render:function render(props){return React.createElement(Shop,{onChange:_this2.onChange,items:_this2.props.itemData,currentCart:_this2.state.currentCart,auth:_this2.state.auth,adminEmailList:_this2.state.adminEmailList});}}),React.createElement(Route,{exact:true,path:\"/signin\",render:function render(){return React.createElement(SignIn,{onChange:_this2.onChange,items:_this2.props.itemData,currentCart:_this2.state.currentCart});}}),React.createElement(Route,{path:\"/cart\",render:function render(props){return React.createElement(Cart,Object.assign({},props,{items:_this2.state.data,currentCart:_this2.state.currentCart,onChange:_this2.onChange,calculateTotalPrice:_this2.calculateTotalPrice,calculateNumItems:_this2.calculateNumItems}));}}),React.createElement(Route,{path:\"/user\",render:function render(props){return React.createElement(UserUI,Object.assign({},props,{items:_this2.state.data,orders:_this2.state.orders,auth:_this2.state.auth}));}}),React.createElement(Route,{path:\"/admin\",render:function render(props){return React.createElement(AdminUI,Object.assign({},props,{items:_this2.state.data,updateStock:_this2.updateStock}));}}),React.createElement(Route,{path:\"/addmerch\",render:function render(props){return React.createElement(AddMerch,Object.assign({},props,{firebasePush:_this2.firebasePush}));}}));}}]);return ShopHome;}(Component);var mapStateToProps=function mapStateToProps(state){return{itemData:state.shop.items//authRedirectPath: state.auth.authRedirectPath\n};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{onPullShopItems:function onPullShopItems(){return dispatch(actions.pullShopItems());}};};export default connect(mapStateToProps,mapDispatchToProps)(ShopHome);","map":{"version":3,"sources":["/Users/Abhinav/Documents/GitHub/saasshop/client/src/containers/ShopHome.jsx"],"names":["React","Component","Route","Redirect","NavBar","Shop","Cart","AdminUI","UserUI","AddMerch","SignIn","Zoomer","Logo","firebase","connect","actions","provider","auth","GoogleAuthProvider","ShopHome","props","pullShopItems","firestore","collection","get","then","snapshot","forEach","item","data","state","id","setState","handleOnPullShopItems","onPullShopItems","pullAdminEmails","doc","adminEmailList","email_list","pullPastOrders","order","orders","firebasePush","console","log","image","ref","storage","name","description","newRef","child","put","getDownloadURL","url","newInventory","category","image_url","on_order","sales_price","price","size_stock","sizes","stock","quantity","add","onChange","itemId","direction","itemData","itemID","cart","currentCart","updatedCount","alert","calculateNumItems","items","total","Object","keys","key","calculateTotalPrice","toFixed","updateStock","currentStock","logOut","signOut","logIn","signInWithRedirect","onAuthStateChanged","user","bind","mapStateToProps","shop","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Route, Redirect } from \"react-router-dom\";\nimport NavBar from \"../components/NavBar/NavBar\";\nimport Shop from \"../components/Shop/Shop\";\nimport Cart from \"../components/Cart/Cart\";\nimport AdminUI from \"../components/Admin/AdminUI\";\nimport UserUI from \"../components/User/UserUI\";\nimport AddMerch from \"../components/Admin/AddMerch\";\nimport \"./ShopHome.css\";\nimport SignIn from \"../components/SignIn/SignIn\";\nimport Zoomer from \"../assets/images/shirts/zoomer.png\";\nimport Logo from \"../assets/images/stickers/SAAS_logo.png\";\nimport firebase from \"../firebase/firebase\";\nimport { connect } from \"react-redux\";\nimport * as actions from \"../store/actions/index.js\";\nconst provider = new firebase.auth.GoogleAuthProvider();\n\nclass ShopHome extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      data: {},\n      currentCart: {},\n      orders: {},\n      adminEmailList: [],\n      auth: null,\n    };\n    firebase.auth().onAuthStateChanged((user) => {\n      this.setState({ auth: user });\n    });\n\n    this.logOut = this.logOut.bind(this);\n    this.logIn = this.logIn.bind(this);\n  }\n\n  componentDidMount() {\n    this.pullShopItems();\n    this.pullPastOrders();\n    this.pullAdminEmails();\n    this.handleOnPullShopItems();\n  }\n\n  //FOR THIS COMPONENT\n  pullShopItems = () => {\n    firebase\n      .firestore()\n      .collection(\"inventory\")\n      .get()\n      .then((snapshot) => {\n        snapshot.forEach((item) => {\n          const data = this.state.data;\n          data[item.id] = item.data();\n          this.setState({ data });\n        });\n      });\n  };\n\n  //FOR REDUX\n  handleOnPullShopItems = () => {\n    this.props.onPullShopItems();\n  };\n\n  pullAdminEmails = () => {\n    firebase\n      .firestore()\n      .collection(\"admin\")\n      .doc(\"emails\")\n      .get()\n      .then((snapshot) => {\n        const data = snapshot.data();\n        this.setState({ adminEmailList: data.email_list });\n      });\n  };\n\n  pullPastOrders = () => {\n    firebase\n      .firestore()\n      .collection(\"orders\")\n      .get()\n      .then((snapshot) => {\n        snapshot.forEach((order) => {\n          const orders = this.state.orders;\n          orders[order.id] = order.data();\n          this.setState({ orders });\n        });\n      });\n  };\n\n  firebasePush = (item) => {\n    console.log(item.image);\n    const ref = firebase.storage().ref();\n    const name = item.description;\n    const newRef = ref.child(name + \".png\");\n    newRef.put(item.image).then(() => {\n      newRef.getDownloadURL().then((url) => {\n        console.log(url);\n        const newInventory = {\n          category: item.category,\n          description: item.description,\n          image_url: url,\n          on_order: 0,\n          sales_price: item.price,\n          size_stock: {},\n          sizes: [],\n          stock: item.quantity,\n        };\n\n        firebase.firestore().collection(\"inventory\").add(newInventory);\n      });\n    });\n  };\n\n  // Function to update the quantity of an item in cart\n  onChange = (itemId, direction) => {\n    console.log(this.state.data[itemId]);\n    console.log(this.props.itemData.itemID);\n    const cart = this.state.currentCart;\n    const currentCart = cart[itemId] ? cart[itemId] : 0;\n    const stock = this.state.data[itemId].stock;\n    let updatedCount =\n      currentCart + direction < 0 ? 0 : currentCart + direction;\n    if (updatedCount > stock) {\n      updatedCount = stock;\n      alert(\"Cannot add item to cart. Max stock of item reached.\");\n    }\n    cart[itemId] = updatedCount;\n    this.setState({ cart });\n  };\n\n  // Function to calculate the total number of items in cart\n  calculateNumItems = (currentCart, items) => {\n    let total = 0;\n\n    Object.keys(items).forEach((key) => {\n      total += currentCart[key] ? currentCart[key] : 0;\n    });\n\n    return total;\n  };\n\n  // Function to calculate total price of items in cart\n  calculateTotalPrice = (currentCart, items) => {\n    let total = 0;\n\n    Object.keys(items).forEach((key) => {\n      total +=\n        items[key].sales_price * (currentCart[key] ? currentCart[key] : 0);\n    });\n\n    return total.toFixed(2);\n  };\n\n  // Function to update the quantity of an item in stock (admin only)\n  // THIS DOESN'T FULLY WORK LOL\n  updateStock = (itemId, direction) => {\n    const data = this.state.data;\n    const currentStock = this.state.data[itemId].stock;\n    let updatedCount =\n      currentStock + direction < 0 ? 0 : currentStock + direction;\n    data[itemId].stock = updatedCount;\n    //need to actually update firebase\n    console.log(data[itemId].stock);\n    this.setState({ data });\n  };\n\n  logOut = () => {\n    console.log(\"log out\");\n    firebase.auth().signOut();\n  };\n\n  logIn = () => {\n    console.log(\"log in\");\n    firebase.auth().signInWithRedirect(provider);\n  };\n\n  render() {\n    //bottom two return the same data\n    //console.log(this.props.itemData)\n    //console.log(this.state.data)\n    return (\n      <React.Fragment>\n        <NavBar\n          items={this.props.itemData}\n          onChange={this.onChange}\n          currentCart={this.state.currentCart}\n          calculateTotalPrice={this.calculateTotalPrice}\n          calculateNumItems={this.calculateNumItems}\n          logIn={this.logIn}\n          logOut={this.logOut}\n          auth={this.state.auth}\n        />\n        <div className=\"gradient-divide\"></div>\n        <Route\n          exact\n          path=\"/\"\n          render={(props) => (\n            <Shop\n              onChange={this.onChange}\n              items={this.props.itemData}\n              currentCart={this.state.currentCart}\n              auth={this.state.auth}\n              adminEmailList={this.state.adminEmailList}\n            />\n          )}\n        />\n        <Route\n          exact\n          path=\"/signin\"\n          render={() => (\n            <SignIn\n              onChange={this.onChange}\n              items={this.props.itemData}\n              currentCart={this.state.currentCart}\n            />\n          )}\n        />\n        <Route\n          path=\"/cart\"\n          render={(props) => (\n            <Cart\n              {...props}\n              items={this.state.data}\n              currentCart={this.state.currentCart}\n              onChange={this.onChange}\n              calculateTotalPrice={this.calculateTotalPrice}\n              calculateNumItems={this.calculateNumItems}\n            />\n          )}\n        />\n\n        <Route\n          path=\"/user\"\n          render={(props) => (\n            <UserUI\n              {...props}\n              items={this.state.data}\n              orders={this.state.orders}\n              auth={this.state.auth}\n            />\n          )}\n        />\n        <Route\n          path=\"/admin\"\n          render={(props) => (\n            <AdminUI\n              {...props}\n              items={this.state.data}\n              updateStock={this.updateStock}\n            />\n          )}\n        />\n\n        <Route\n          path=\"/addmerch\"\n          render={(props) => (\n            <AddMerch {...props} firebasePush={this.firebasePush} />\n          )}\n        />\n      </React.Fragment>\n    );\n  }\n}\n\nconst mapStateToProps = (state) => {\n  return {\n    itemData: state.shop.items,\n    //authRedirectPath: state.auth.authRedirectPath\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    onPullShopItems: () => dispatch(actions.pullShopItems()),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ShopHome);\n"]},"metadata":{},"sourceType":"module"}